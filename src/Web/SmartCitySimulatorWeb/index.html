<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
</head>
<body>
    Smart City Simulator Live Charts

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-1.6.4.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>

    <!-- Add charting -->
    <script src="http://code.highcharts.com/highcharts.js"></script>

    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        var chart; // global


        $(function () {
            // Declare a proxy to reference the hub.
            var smartCitySimulatorHub = $.connection.smartCitySimulatorHub;

            // Create a function that the hub can call to update the charts.
            smartCitySimulatorHub.client.updateCharts = function (smartCityEvent) {
                //do something when called from the server
                chart1.series[0].setData(
                    [
                     smartCityEvent.parkedCount -1000,
                     smartCityEvent.vehicleCount-1000,
                     smartCityEvent.income/1000,
                     smartCityEvent.expenses /1000
                    ]);

                chart1.setTitle({ text: smartCityEvent.cityName});

                console.log(smartCityEvent);
            };

            //sample smartCityEvent
            //{
            //    "gameTime": "08/07/2022 10:48:35.456 PM",
            //    "cityName": "Springdale",
            //    "parkedCount": "1269",
            //    "vehicleCount": "2742",
            //    "income": "52994.53",
            //    "expenses": "82802.92"
            //}

            // Start the connection.
            $.connection.hub.start().done(function () {
                //do something when connection is made

                //test: call the server function
                smartCitySimulatorHub.server.send("message test on startup");
            });

            //$('#container').highcharts({
            var chart1 = new Highcharts.Chart({
                chart: {
                    type: 'bar',
                    renderTo: 'container'
                },
                title: {
                    text: 'City Name'
                },
                xAxis: {
                    categories: ['Parked Cars', 'Total Cars', 'Income', 'Expenses']
                },
                yAxis: {
                    title: {
                        text: ''
                    }
                },
                series: [{
                    name: '',
                    data: []
                }]
            });

        });
    </script>

    <!-- Container for the chart -->
    <div id="container" style="width:100%; height:400px;"></div>


</body>
</html>
